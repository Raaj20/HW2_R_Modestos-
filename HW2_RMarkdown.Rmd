---
title: "R Markdown for HW2"
author: "Modestos A. Modestou"
date: "2025-03-17"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(data.table)
library(tidyverse)
```

## R Markdown

This is an R Markdown document for the R assignment (HW2) in BCB546.

# *Part I - Data Inspection*

**1.** **fang_et-al_genotypes**:

```{r inspection1}
setwd("Common_files")
fang_et_al_genotypes <- read_delim("fang_et_al_genotypes.txt", 
    delim = "\t", escape_double = FALSE, 
    trim_ws = TRUE)
```

Ordered lists:

a. The file has one header line
b. It contains 2782 lines (excluding the header line) and 986 columns


```{r size1}
setwd("Common_files")
file_size_mb <- file.size("fang_et_al_genotypes.txt") / (1024 * 1024)
print(paste("File size:", round(file_size_mb, 2), "MB"))
```


c. The size of the file is 10.54 MB (Megabytes)


**2.** **snp_position**:

```{r inspection2}
setwd("Common_files")
snp_position <- read_delim("snp_position.txt", 
    delim = "\t", escape_double = FALSE, 
    trim_ws = TRUE)
```

Ordered lists:

a. The file has one header line
b. It contains 983 lines (excluding the header line) and 15 columns


```{r size2}
setwd("Common_files")
file_size_mb <- file.size("snp_position.txt") / 1024 
print(paste("File size:", round(file_size_mb, 2), "KB"))
```


c. The size of the file is 80.82 KB (Kilobytes)



# *Part II - Data Processing*

## Common Data for Maize and Teosinte


1. Remove the first two lines (i.e., the header line and the first line) from the provided file transposed_genotypes.txt and save the new file as transposed_oneheader.txt in Common_files.


```{r remove_twoheaders}
setwd("Common_files")
lines <- readLines("transposed_genotypes.txt")
lines <- lines[-c(1, 2)]
writeLines(lines, "transposed_oneheader.txt")
```


2. Replace "Group" with "SNP_ID" in the header line of the file transposed_oneheader.txt and save the new file as transposed_editedheader.txt in Common_files.

```{r edit_header}
setwd("Common_files")
lines <- readLines("transposed_oneheader.txt")
lines <- gsub("Group", "SNP_ID", lines)
writeLines(lines, "transposed_editedheader.txt")
```


3. Join the tab-delimited files snp_position.txt and transposed_editedheader.txt based on their first column and save the result to joined_unedited.txt in Common_files.


```{r join_unedited}
setwd("Common_files")
snp_position <- read.delim("snp_position.txt", header = TRUE, sep = "\t")
transposed_editedheader <- read.delim("transposed_editedheader.txt", header = TRUE, sep = "\t")
joined_data <- inner_join(snp_position, transposed_editedheader, by = colnames(snp_position)[1])
write.table(joined_data, "joined_unedited.txt", sep = "\t", row.names = FALSE, quote = FALSE)
```


4. Remove the second column from the joined_unedited.txt and save the output into joined_final.txt in Common_files.

```{r join_final}
setwd("Common_files")
data <- fread("joined_unedited.txt", sep = "\t", header = TRUE)
data <- data[, -2, with = FALSE]
fwrite(data, "joined_final.txt", sep = "\t", quote = FALSE)
```


### Data for Maize


1. Filter column names containing "ZMMIL" in the file joined_final.txt and save the output to the new file ZMMIL.txt in Common_files.


```{r, ZMMIL}
setwd("Common_files")
header <- fread("joined_final.txt", nrows = 1, header = FALSE, sep = "\t")
header_dt <- data.table(Index = seq_along(header), Column = as.character(unlist(header)))
zmmil_dt <- header_dt[grepl("ZMMIL", Column)]
fwrite(zmmil_dt, "ZMMIL.txt", sep = "\t", quote = FALSE, col.names = FALSE)
```


2. Filter column names containing "ZMMLR" in the file joined_final.txt and save the output to the new file ZMMLR.txt in Common_files.


```{r, ZMMLR}
setwd("Common_files")
header <- fread("joined_final.txt", nrows = 1, header = FALSE, sep = "\t")
header_dt <- data.table(Index = seq_along(header), Column = as.character(unlist(header)))
zmmlr_dt <- header_dt[grepl("ZMMLR", Column)]
fwrite(zmmlr_dt, "ZMMLR.txt", sep = "\t", quote = FALSE, col.names = FALSE)
```


3. Filter column names containing "ZMMMR" in the file joined_final.txt and save the output to the new file ZMMMR.txt in Common_files.


```{r, ZMMMR}
setwd("Common_files")
header <- fread("joined_final.txt", nrows = 1, header = FALSE, sep = "\t")
header_dt <- data.table(Index = seq_along(header), Column = as.character(unlist(header)))
zmmmr_dt <- header_dt[grepl("ZMMMR", Column)]
fwrite(zmmmr_dt, "ZMMMR.txt", sep = "\t", quote = FALSE, col.names = FALSE)
```


4. Extract the specified columns from joined _final.txt and save the output in maize_data.txt in the Common_files.


```{r maize_data}
setwd("Common_files")
data <- fread("joined_final.txt", sep = "\t", header = TRUE)
selected_columns <- c(1, 2, 3, 1224:2479, 2480:2506, 2507:2796)
maize_data <- data[, ..selected_columns]
fwrite(maize_data, "maize_data.txt", sep = "\t", quote = FALSE)
```


5. Sort maize_data.txt numerically by column 2, i.e., chromosome column, while keeping the header intact and then save the sorted output to sorted_maize.txt in Common_files.


```{r sort_maize_data}
setwd("Common_files")
file_path <- "maize_data.txt"
data <- fread(file_path, sep = "\t", header = TRUE)
col_name <- grep("^Chromosome$", names(data), value = TRUE)
data[, (col_name) := suppressWarnings(as.numeric(get(col_name)))]
data <- data[!is.na(get(col_name))]
sorted_data <- data[order(get(col_name)), ]
output_path <- "sorted_maize.txt"
fwrite(sorted_data, output_path, sep = "\t", quote = FALSE)
```


6. This loop extracts rows where column 2 equals a specific value ($i) from sorted_maize.txt and saves the filtered data into separate files (maize_chr01.txt, maize_chr02.txt, ..., maize_chr10.txt), preserving the header in each file. The individual files are saved in Common_files.


```{r maize_chromosomes}
setwd("Common_files")
file_path <- "sorted_maize.txt"
data <- fread(file_path, sep = "\t", header = TRUE)
# Loop through chromosome values (1 to 10) and create separate files
for (i in 1:10) {
  # Filter rows where Chromosome == i
  subset_data <- data[get(col_name) == i]
  if (nrow(subset_data) > 0) {
    output_file <- sprintf("maize_chr%02d.txt", i)
    fwrite(subset_data, output_file, sep = "\t", quote = FALSE)
  }
}
```


### Final Data for Maize


1. This loop goes through the maize_chr01.txt to maize_chr10.txt files, sorts each file numerically in increasing order by column 3 while keeping the header intact, and saves the sorted output to Maize_Sorted_Increasing.


```{r maize_sorted_increasing}
input_dir <- "Common_files"
output_dir <- "Maize_Sorted_Increasing"  
# Loop through maize_chr01.txt to maize_chr10.txt
for (i in 1:10) {
# Construct input and output file paths
  input_file <- file.path(input_dir, sprintf("maize_chr%02d.txt", i))
  output_file <- file.path(output_dir, sprintf("maize_chr%02d.txt", i))
# Read data, preserving the header
    data <- fread(input_file, sep = "\t", header = TRUE)
# Identify the actual name of column 3
  col_pos <- colnames(data)[3]  
# Ensure that column 3 ("Position") is converted to a numeric format
    data[[col_pos]] <- suppressWarnings(as.numeric(data[[col_pos]]))
# Remove NA values and sort by column 3 in increasing order
    sorted_data <- data[!is.na(get(col_pos)), ][order(get(col_pos)), ]
# Write the sorted file to the new directory
    fwrite(sorted_data, output_file, sep = "\t", quote = FALSE)
  }
```


2. This loop goes through the maize_chr01.txt to maize_chr10.txt files, sorts each file numerically in decreasing order by column 3 while keeping the header intact, and replaces ?/? with -/- in the output. The sorted output is then saved in Maize_Sorted_Decreasing.


```{r maized_sorted_decreasing}
input_dir <- "Common_files"
output_dir <- "Maize_Sorted_Decreasing"  
# Loop through maize_chr01.txt to maize_chr10.txt
for (i in 1:10) {
# Construct input and output file paths
  input_file <- file.path(input_dir, sprintf("maize_chr%02d.txt", i))
  output_file <- file.path(output_dir, sprintf("maize_chr%02d.txt", i))
# Read data, preserving the header
    data <- fread(input_file, sep = "\t", header = TRUE)
# Identify the actual name of column 3
  col_pos <- colnames(data)[3]  
# Ensure that column 3 ("Position") is converted to a numeric format
    data[[col_pos]] <- suppressWarnings(as.numeric(data[[col_pos]]))
# Replace '?/? with '-/-'
    data <- data[, lapply(.SD, function(x) gsub("\\?/\\?", "-/-", x)), .SDcols = names(data)]
# Remove NA values and sort by column 3 in decreasing order
    sorted_data <- data[!is.na(get(col_pos)), ][order(-get(col_pos)), ]
# Write the sorted file to the new directory
    fwrite(sorted_data, output_file, sep = "\t", quote = FALSE)
  }
```


### Data for Teosinte


1. Filter column names containing "ZMPBA" in the file joined_final.txt and save the output to the new file ZMPBA.txt in Common_files.


```{r, ZMPBA}
setwd("Common_files")
header <- fread("joined_final.txt", nrows = 1, header = FALSE, sep = "\t")
header_dt <- data.table(Index = seq_along(header), Column = as.character(unlist(header)))
zmpba_dt <- header_dt[grepl("ZMPBA", Column)]
fwrite(zmpba_dt, "ZMPBA.txt", sep = "\t", quote = FALSE, col.names = FALSE)
```


2. Filter column names containing "ZMPIL" in the file joined_final.txt and save the output to the new file ZMPIL.txt in Common_files.


```{r, ZMPIL}
setwd("Common_files")
header <- fread("joined_final.txt", nrows = 1, header = FALSE, sep = "\t")
header_dt <- data.table(Index = seq_along(header), Column = as.character(unlist(header)))
zmpil_dt <- header_dt[grepl("ZMPIL", Column)]
fwrite(zmpil_dt, "ZMPIL.txt", sep = "\t", quote = FALSE, col.names = FALSE)
```


3. Filter column names containing "ZMPJA" in the file joined_final.txt and save the output to the new file ZMPJA.txt in Common_files.


```{r, ZMPJA}
setwd("Common_files")
header <- fread("joined_final.txt", nrows = 1, header = FALSE, sep = "\t")
header_dt <- data.table(Index = seq_along(header), Column = as.character(unlist(header)))
zmpja_dt <- header_dt[grepl("ZMPJA", Column)]
fwrite(zmpja_dt, "ZMPJA.txt", sep = "\t", quote = FALSE, col.names = FALSE)
```


4. Extract the specified columns from joined _final.txt and save the output in teosinte_data.txt in the Common_files.


```{r teosinte_data}
setwd("Common_files")
data <- fread("joined_final.txt", sep = "\t", header = TRUE)
selected_columns <- c(1, 2, 3, 88:987, 988:1021, 1177:1217)
teosinte_data <- data[, ..selected_columns]
fwrite(teosinte_data, "teosinte_data.txt", sep = "\t", quote = FALSE)
```


5. Sort teosinte_data.txt numerically by column 2, i.e., chromosome column, while keeping the header intact and then save the sorted output to sorted_teosinte.txt in Common_files.


```{r sort_teosinte_data}
setwd("Common_files")
file_path <- "teosinte_data.txt"
data <- fread(file_path, sep = "\t", header = TRUE)
col_name <- grep("^Chromosome$", names(data), value = TRUE)
data[, (col_name) := suppressWarnings(as.numeric(get(col_name)))]
data <- data[!is.na(get(col_name))]
sorted_data <- data[order(get(col_name)), ]
output_path <- "sorted_teosinte.txt"
fwrite(sorted_data, output_path, sep = "\t", quote = FALSE)
```


6. This loop extracts rows where column 2 equals a specific value ($i) from sorted_teosinte.txt and saves the filtered data into separate files (teosinte_chr01.txt, teosinte_chr02.txt, ..., teosinte_chr10.txt), preserving the header in each file. The individual files are saved in Common_files.


```{r teosinte_chromosomes}
setwd("Common_files")
file_path <- "sorted_teosinte.txt"
data <- fread(file_path, sep = "\t", header = TRUE)
# Loop through chromosome values (1 to 10) and create separate files
for (i in 1:10) {
  # Filter rows where Chromosome == i
  subset_data <- data[get(col_name) == i]
  if (nrow(subset_data) > 0) {
    output_file <- sprintf("teosinte_chr%02d.txt", i)
    fwrite(subset_data, output_file, sep = "\t", quote = FALSE)
  }
}
```


### Final Data for Teosinte


1. This loop goes through the teosinte_chr01.txt to teosinte_chr10.txt files, sorts each file numerically in increasing order by column 3 while keeping the header intact, and saves the sorted output to Teosinte_Sorted_Increasing.


```{r teosinte_sorted_increasing}
input_dir <- "Common_files"
output_dir <- "Teosinte_Sorted_Increasing"  
# Loop through teosinte_chr01.txt to teosinte_chr10.txt
for (i in 1:10) {
# Construct input and output file paths
  input_file <- file.path(input_dir, sprintf("teosinte_chr%02d.txt", i))
  output_file <- file.path(output_dir, sprintf("teosinte_chr%02d.txt", i))
# Read data, preserving the header
    data <- fread(input_file, sep = "\t", header = TRUE)
# Identify the actual name of column 3
  col_pos <- colnames(data)[3]  
# Ensure that column 3 ("Position") is converted to a numeric format 
    data[[col_pos]] <- suppressWarnings(as.numeric(data[[col_pos]]))
# Remove NA values and sort by column 3 in increasing order
    sorted_data <- data[!is.na(get(col_pos)), ][order(get(col_pos)), ]
# Write the sorted file to the new directory
    fwrite(sorted_data, output_file, sep = "\t", quote = FALSE)
  }
```


2. This loop goes through the teosinte_chr01.txt to teosinte_chr10.txt files, sorts each file numerically in decreasing order by column 3 while keeping the header intact, and replaces ?/? with -/- in the output. The sorted output is then saved in Teosinte_Sorted_Decreasing.


```{r teosinte_sorted_decreasing}
input_dir <- "Common_files"
output_dir <- "Teosinte_Sorted_Decreasing"  
# Loop through teosinte_chr01.txt to teosinte_chr10.txt
for (i in 1:10) {
# Construct input and output file paths
  input_file <- file.path(input_dir, sprintf("teosinte_chr%02d.txt", i))
  output_file <- file.path(output_dir, sprintf("teosinte_chr%02d.txt", i))
# Read data, preserving the header
    data <- fread(input_file, sep = "\t", header = TRUE)
# Identify the actual name of column 3
  col_pos <- colnames(data)[3]  
# Ensure that column 3 ("Position") is converted to a numeric format
    data[[col_pos]] <- suppressWarnings(as.numeric(data[[col_pos]]))
# Replace '?/? with '-/-'
    data <- data[, lapply(.SD, function(x) gsub("\\?/\\?", "-/-", x)), .SDcols = names(data)]
# Remove NA values and sort by column 3 in decreasing order
    sorted_data <- data[!is.na(get(col_pos)), ][order(-get(col_pos)), ]
# Write the sorted file to the new directory
    fwrite(sorted_data, output_file, sep = "\t", quote = FALSE)
  }
```



# *Part II - Data Vizualization*






